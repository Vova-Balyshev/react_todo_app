(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{21:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),o=n(10),r=(n(19),n(20),n(21),n(8)),l=n(2),i="https://mate.academy/students-api";function s(e){return new Promise((function(t){setTimeout(t,e)}))}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),s(300).then((function(){return fetch(i+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var d,j=function(e){return u(e)},b=function(e,t){return u(e,"POST",t)},f=function(e,t){return u(e,"PATCH",t)},m=function(e){return u(e,"DELETE")},p=n(4),h=n(5),O=n(3),x=n.n(O),v=function(){var e=Object(h.a)(Object(p.a)().mark((function e(t){var n;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(h.a)(Object(p.a)().mark((function e(t){var n,c;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",b("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=n(0),N=function(e){var t=e.onLogin,n=Object(c.useState)(""),a=Object(l.a)(n,2),o=a[0],r=a[1],i=Object(c.useState)(""),s=Object(l.a)(i,2),u=s[0],d=s[1],j=Object(c.useState)(!1),b=Object(l.a)(j,2),f=b[0],m=b[1],O=Object(c.useState)(!1),N=Object(l.a)(O,2),T=N[0],k=N[1],_=Object(c.useState)(""),C=Object(l.a)(_,2),S=C[0],w=C[1],A=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(c.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){}}),[t]);var E=function(){var e=Object(h.a)(Object(p.a)().mark((function e(){var t;return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(o);case 2:(t=e.sent)?A(t):m(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(h.a)(Object(p.a)().mark((function e(t){return Object(p.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),w(""),k(!0),e.prev=3,!f){e.next=9;break}return e.next=7,y({name:u,email:o}).then(A);case 7:e.next=11;break;case 9:return e.next=11,E();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),w("Something went wrtong");case 16:return e.prev=16,k(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)("form",{onSubmit:F,className:"box mt-5",children:[Object(g.jsx)("h1",{className:"title is-3",children:f?"You need to register":"Log in to open todos"}),Object(g.jsxs)("div",{className:"field",children:[Object(g.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(g.jsxs)("div",{className:x()("control has-icons-left",{"is-loading":T}),children:[Object(g.jsx)("input",{type:"email",id:"user-email",className:x()("input",{"is-danger":!f&&S}),placeholder:"Enter your email",disabled:T||f,value:o,required:!0,onChange:function(e){return r(e.target.value)}}),Object(g.jsx)("span",{className:"icon is-small is-left",children:Object(g.jsx)("i",{className:"fas fa-envelope"})})]}),!f&&S&&Object(g.jsx)("p",{className:"help is-danger",children:S})]}),f&&Object(g.jsxs)("div",{className:"field",children:[Object(g.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(g.jsxs)("div",{className:x()("control has-icons-left",{"is-loading":T}),children:[Object(g.jsx)("input",{type:"text",id:"user-name",className:x()("input",{"is-danger":f&&S}),placeholder:"Enter your name",required:!0,minLength:4,disabled:T,value:u,onChange:function(e){return d(e.target.value)}}),Object(g.jsx)("span",{className:"icon is-small is-left",children:Object(g.jsx)("i",{className:"fas fa-user"})})]}),f&&S&&Object(g.jsx)("p",{className:"help is-danger",children:S})]}),Object(g.jsx)("div",{className:"field",children:Object(g.jsx)("button",{type:"submit",className:x()("button is-primary",{"is-loading":T}),children:f?"Register":"Login"})})]})},T=a.a.createContext(null),k=function(e){var t=e.children,n=Object(c.useState)(null),a=Object(l.a)(n,2),o=a[0],r=a[1];return o?Object(g.jsx)(T.Provider,{value:o,children:t}):Object(g.jsx)(N,{onLogin:r})};!function(e){e[e.All=0]="All",e[e.Active=1]="Active",e[e.Completed=2]="Completed"}(d||(d={}));var _=a.a.memo((function(e){var t=e.todos,n=e.filterType,c=e.handleFilter,a=e.handleDeleteTodo,o=t.filter((function(e){return e.completed}));return Object(g.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(g.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(t.length-o.length," left todo")}),Object(g.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(g.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:x()("filter__link",{selected:n===d.All}),onClick:function(){return c(d.All)},children:"All"}),Object(g.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:x()("filter__link",{selected:n===d.Active}),onClick:function(){return c(d.Active)},children:"Active"}),Object(g.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:x()("filter__link",{selected:n===d.Completed}),onClick:function(){return c(d.Completed)},children:"Completed"})]}),o.length>0&&Object(g.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",onClick:function(){t.forEach((function(e){e.completed&&a(e.id)}))},children:"Clear completed"})]})})),C=a.a.memo((function(e){var t=e.todo,n=e.handleDeleteTodos,a=e.handleUpdateTodos,o=e.selectedTodoId,r=e.isLoading,i=t.id,s=t.title,u=t.completed,d=Object(c.useState)(!1),j=Object(l.a)(d,2),b=j[0],f=j[1],m=Object(c.useState)(s),p=Object(l.a)(m,2),h=p[0],O=p[1],v=function(e){e.preventDefault(),f(!1),h!==s&&(0!==h.length?a(i,{title:h}):n(i))};return Object(g.jsxs)("div",{"data-cy":"Todo",className:x()("todo",{completed:u}),children:[Object(g.jsx)("label",{className:"todo__status-label",children:Object(g.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",checked:u,className:"todo__status",disabled:b,onClick:function(){a(i,{completed:!u})}})}),b?Object(g.jsx)(g.Fragment,{children:Object(g.jsx)("form",{onSubmit:v,children:Object(g.jsx)("input",{"data-cy":"TodoTitleField",type:"text",placeholder:"Empty todo will be deleted",value:h,onChange:function(e){O(e.target.value)},className:"todo__title-field",onKeyDown:function(e){"Escape"===e.key&&(f(!1),O(s))},onBlur:v})})}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("span",{"data-cy":"TodoTitle",role:"presentation",className:"todo__title",onDoubleClick:function(){f(!0)},children:s}),Object(g.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){return n(i)},children:"\xd7"}),(o===i||-1===i)&&Object(g.jsxs)("div",{"data-cy":"TodoLoader",className:x()("modal overlay",{"is-active":r}),children:[Object(g.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(g.jsx)("div",{className:"loader"})]})]})]})})),S=Object(c.memo)((function(e){var t=e.todos,n=e.todoTitle,a=e.handleTogleAll,o=e.handleAddTodo,r=e.setTodoTitle,l=Object(c.useRef)(null);return Object(c.useEffect)((function(){l.current&&l.current.focus()}),[]),Object(g.jsxs)("header",{className:"todoapp__header",children:[Object(g.jsx)("button",{"data-cy":"ToggleAllButton",type:"button",className:x()("todoapp__toggle-all",{active:t.every((function(e){return e.completed}))}),onClick:function(){return a()}}),Object(g.jsx)("form",{onSubmit:function(e){return o(e)},children:Object(g.jsx)("input",{"data-cy":"NewTodoField",type:"text",ref:l,className:"todoapp__new-todo",placeholder:"What needs to be done?",value:n,onChange:function(e){return r(e.target.value)}})})]})})),w=function(){var e=Object(c.useContext)(T),t=Object(c.useState)([]),n=Object(l.a)(t,2),a=n[0],o=n[1],i=Object(c.useState)(""),s=Object(l.a)(i,2),u=s[0],p=s[1],h=Object(c.useState)(0),O=Object(l.a)(h,2),x=O[0],v=O[1],y=Object(c.useState)(d.All),N=Object(l.a)(y,2),k=N[0],w=N[1],A=Object(c.useState)(!0),E=Object(l.a)(A,2),F=E[0],L=E[1],D=Object(c.useState)(!1),I=Object(l.a)(D,2),U=I[0],B=I[1],J=Object(c.useState)(0),P=Object(l.a)(J,2),R=P[0],q=P[1],H=Object(c.useState)(""),Y=Object(l.a)(H,2),G=Y[0],K=Y[1];Object(c.useEffect)((function(){e&&(v(e.id),function(e){return j("/todos?userId=".concat(e))}(null===e||void 0===e?void 0:e.id).then((function(e){return o(e)})).catch((function(){return K("Unable to load a todo")})))}),[e]);var M=Object(c.useCallback)((function(e){var t;(e.preventDefault(),0!==u.trim().length)?(B(!0),o((function(e){return[].concat(Object(r.a)(e),[{id:-1,userId:x,title:u,completed:!1}])})),(t={title:u,userId:x,completed:!1},b("/todos",t)).then((function(e){o((function(t){var n=Object(r.a)(t),c=t.findIndex((function(e){return-1===e.id}));return-1===c?t:(n[c]=e,n)}))})).catch((function(){return K("Unable to add a todo")})).finally((function(){p(""),B(!1),K("")}))):K("Please write a title")}),[u,x]),W=Object(c.useCallback)((function(e){B(!0),q(e),function(e){return m("/todos/".concat(e))}(e).then((function(t){t&&o((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(){return K("Unable to delete a todo")})).finally((function(){B(!1),K("")}))}),[]),z=Object(c.useCallback)((function(e,t){B(!0),q(e),function(e,t){return f("/todos/".concat(e),t)}(e,t).then((function(t){o((function(n){return n.map((function(n){return n.id===e?t:n}))}))})).catch((function(){return K("Unable to update a todo")})).finally((function(){K(""),B(!1)}))}),[]),Q=Object(c.useMemo)((function(){switch(k){case d.Active:return a.filter((function(e){return!e.completed}));case d.Completed:return a.filter((function(e){return e.completed}));default:return Object(r.a)(a)}}),[a,k]);return Object(g.jsxs)("div",{className:"todoapp",children:[Object(g.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(g.jsx)(S,{todos:a,todoTitle:u,setTodoTitle:p,handleAddTodo:M,handleTogleAll:function(){a.forEach((function(e){return z(e.id,{completed:F})})),q(0),L(!F)}}),Object(g.jsxs)("div",{className:"todoapp__content",children:[a.length>0&&Object(g.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Q.map((function(e){return Object(g.jsx)(C,{todo:e,handleDeleteTodos:W,handleUpdateTodos:z,isLoading:U,selectedTodoId:R},e.id)}))}),Object(g.jsx)(_,{todos:Q,filterType:k,handleFilter:w,handleDeleteTodo:W})]}),G&&Object(g.jsxs)("div",{"data-cy":"ErrorNotification",className:"notification is-danger is-light has-text-weight-normal",children:[Object(g.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return K("")}}),G]})]})},A=function(){return Object(g.jsx)(k,{children:Object(g.jsx)(w,{})})};Object(o.createRoot)(document.getElementById("root")).render(Object(g.jsx)(A,{}))}},[[23,1,2]]]);
//# sourceMappingURL=main.8dd8c3d1.chunk.js.map